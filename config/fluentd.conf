<source>
  @type elb_access_log
  aws_key_id XXXXXXXXXXXXXXXXXXXXXXXXXX
  aws_sec_key YYYYYYYYYYYYYYYYYYYYYYYYY
  account_id 1234567890
  region eu-west-1
  s3_bucket featuredms-access-logs
  tag elb.log
  start_datetime 2017/08/21 00:01
</source>
<filter **>
  @type record_transformer
  renew_record true
  keep_keys elb,client_port,backend_port,request_processing_time,backend_processing_time,response_processing_time,elb_status_code,backend_status_code,received_bytes,sent_bytes,request,user_agent,ssl_cipher,ssl_protocol,client,backend
  remove_keys request.method,request.uri,request.http_version,request.uri.scheme,request.uri.user,request.uri.host,request.uri.port,request.uri.path,request.uri.query,request.uri.fragment
  enable_ruby 
  <record>
    request_method ${record["request.method"]}
  </record>
  <record>
    request_uri ${record["request.uri"]}
  </record>
  <record>
    request_http_version ${record["request.http_version"]}
  </record>
  <record>
    request_uri_scheme ${record["request.uri.scheme"]}
  </record>
  <record>
    request_uri_user ${record["request.uri.user"]}
  </record>
  <record>
    request_uri_host ${record["request.uri.host"]}
  </record>
  <record>
    request_uri_port ${record["request.uri.port"]}
  </record>
  <record>
    request_uri_path ${record["request.uri.path"]}
  </record>
  <record>
    request_uri_query ${record["request.uri.query"]}
  </record>
  <record>
    request_uri_fragment ${record["request.uri.fragment"]}
  </record>
</filter>
<match **>
    @type forest
    subtype elasticsearch
    <template>
        logstash_format true
        logstash_prefix elb.log
        host search-coral-logs-elb-access-tst-pjapuuwcdog2kc3i3fapf4efd4.eu-west-1.es.amazonaws.com
        port 80
        index_name elb.log
        type_name elb.log
        flush_interval 5s
        buffer_chunk_limit 2M
        buffer_queue_limit 24
        max_retry_wait 30
        request_timeout 10s
        reconnect_on_error true
    </template>
</match>